#include "SteppingAction.hh"
#include "EventAction.hh"
#include "G4Step.hh"
#include "G4Track.hh"
#include "G4ParticleDefinition.hh"
#include "G4Neutron.hh"
#include "G4SystemOfUnits.hh"

SteppingAction::SteppingAction(EventAction* eventAction)
 : G4UserSteppingAction(),
   fEventAction(eventAction)
{}

SteppingAction::~SteppingAction() {}

void SteppingAction::UserSteppingAction(const G4Step* step)
{
    auto track = step->GetTrack();

    // Solo neutrones
    if (track->GetDefinition() != G4Neutron::Definition())
        return;

    // Detecta cuando entra al volumen de salida
    auto volumeName = track->GetVolume()->GetName();

    if (volumeName == "Detector" || volumeName == "TargetExit")
    {
        G4double energy = step->GetPreStepPoint()->GetKineticEnergy();
        fEventAction->RecordNeutronEnergy(energy);
    }
}
